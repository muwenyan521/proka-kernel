# BMF (Bitmap Font) 文件格式文档

## 概述
BMF 是一种优化的点阵字体文件格式，专为嵌入式系统和资源受限环境设计。它支持高效的字符查找和大字符集存储。

## 文件结构
BMF 文件由四部分组成：
1. 文件头 (24字节)
2. Unicode 码表
3. 位图数据
4. 哈希表

## 文件头 (24字节)
| 偏移 | 长度 | 描述 | 类型 | 备注 |
|------|------|------|------|------|
| 0x00 | 3    | 魔数 | 字节 | 固定为 `0x0B 0x2D 0x0E` |
| 0x03 | 3    | 位图数据起始偏移 | 小端序3字节整数 | 从文件开始计算 |
| 0x06 | 1    | 字号 | 字节 | 点阵高度和宽度(像素) |
| 0x07 | 1    | 单字符字节数 | 字节 | 每个字符占用的字节数 |
| 0x08 | 3    | 哈希表起始偏移 | 小端序3字节整数 | 从文件开始计算 |
| 0x0B | 3    | 哈希槽数量 | 小端序3字节整数 | 哈希表总槽数 |
| 0x0E | 10   | 保留 | - | 预留扩展空间 |

## Unicode 码表
紧接在文件头之后，包含文件中所有字符的Unicode码列表：
- 每个字符占用2字节
- 按小端序存储
- 字符按Unicode值排序

## 位图数据
存储所有字符的点阵数据：
- 每个字符占用 `单字符字节数` 字节
- 位图格式为MONO_HLSB (水平扫描，高位在前)
- 每行字节数 = ceil(字号/8)
- 总行数 = 字号

## 哈希表 (开放寻址法)
用于快速查找字符：
- 每个槽6字节：
  - 前2字节：Unicode码 (小端序)
  - 后4字节：位图数据偏移 (小端序)
- 哈希函数：`slot = unicode % hash_slots`
- 冲突处理：线性探测

## 字符点阵格式
每个字符的点阵数据按以下方式组织：
1. 图像被转换为单色位图 (1=黑，0=白)
2. 每行从左到右编码为位
3. 每8位组成一个字节 (高位在前)
4. 不足8位的行末尾补0

## 限制
- 最大字号: 42像素
- 最大字符数: 理论上受3字节偏移限制 (16MB)